@using Microsoft.AspNet.Identity.EntityFramework
@using Microsoft.AspNet.Identity
@using Microsoft.AspNet.Identity.Owin
@using System.Linq
@using System.Data.Entity
@using ewide.web
@{
    var currentUser = Request.GetOwinContext().GetUserManager<ApplicationUserManager>()
        .FindById(User.Identity.GetUserId());
    var AppDb = Request.GetOwinContext().Get<ewide.web.Models.ApplicationDbContext>();
    var sessionId = Convert.ToInt32(Request["id"]);
    var session = AppDb.CoachingSessions
        .Include(i => i.Room)
        .FirstOrDefault(i => i.Id.Equals(sessionId));
    var guestRoomUrl = session.Room.Link;
    //var guestRoomUrl = "https://trial.natr.com.au/flex.html?roomdirect.html&key=2AiCPbG2xke4Xldm5HA1W51X54";
}
<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <!-- No cache -->
    <meta http-equiv="cache-control" content="max-age=0" />
    <meta http-equiv="cache-control" content="no-cache" />
    <meta http-equiv="expires" content="0" />
    <meta http-equiv="expires" content="Tue, 01 Jan 1980 1:00:00 GMT" />
    <meta http-equiv="pragma" content="no-cache" />
    <!-- Tell Windows 8 to run a desktop version of IE -->
    <meta http-equiv="X-UA-Compatible" content="IE=edge;requiresActiveX=true"/>
    <link rel="shortcut icon" href="favicon.ico">
    <!-- Title -->
    <title>right.now.: Video Session</title>
    <!-- Bootstrap css -->
    <link href="css/bootstrap.min.css" rel="stylesheet">
    <link href="css/elusive-webfont.css" rel="stylesheet">
    <link href="css/bootstrap-notify.css" rel="stylesheet">

    @*<link rel="stylesheet" href="http://localhost:3000/.tmp/base.dm.css">
    <link rel="stylesheet" href="http://localhost:3000/.tmp/styles.css">*@
    <!--[if lte IE 7]><script src="scripts/libs/lte-ie7.js"></script><![endif]-->
    <!-- Custom css -->
    <link rel="stylesheet" href="css/vidyo-app.css">
    <link rel="stylesheet" href="css/rightnow.css">
</head>
<body>
    <div id="withjs" class="hide">
        <!-- Splash screen -->
        <div class="splash" id="splash">
            <div><img src="/images/logo-vertical.png" alt="right.now. Logo" /></div>
            <div id="splashText" style="margin-top: 15px;"><p>Preparing video configuration</p></div>
            

            <div class="loading-indicator border-box">
                <div class="progress-circular progress-circular-alt progress-circular-center">
                    <div class="progress-circular-wrapper">
                        <div class="progress-circular-inner">
                            <div class="progress-circular-left">
                                <div class="progress-circular-spinner"></div>
                            </div>
                            <div class="progress-circular-gap"></div>
                            <div class="progress-circular-right">
                                <div class="progress-circular-spinner"></div>
                            </div>
                        </div>
                    </div>
                </div>

            </div>

        </div>
        <!-- End Splash screen -->
        <!-- Error view -->
        <div id="errorWrapper" class="alert alert-error hide">
            <a href="#" class="close" data-hide="alert">&times;</a>
        </div>
        <!-- End Error view -->
        <!-- Info view -->
        <div id="infoWrapper" class="alert alert-info hide">
            <a href="#" class="close" data-hide="alert">&times;</a>
        </div>
        <!-- End Error view -->
        <!-- Main Menu -->
        <div class="hide text-center login-container" id="mainMenu">
            @*<h2>VidyoWeb API sample - @currentUser.FirstName</h2>
            <!-- <h3>Choose the type of interaction</h3> -->
            <form class="form-inline">
                <input value="@guestRoomUrl" class="input-xxlarge guestLoginInput" id="guestURL" type="hidden" placeholder="http://PORTAL_ADDRESS/flex.html?roomdirect.html&amp;key=U2AnrCjEaMBx" tabindex="1">
                <input value="@currentUser.FirstName" id="guestName" type="hidden" placeholder="Your Name" class="guestLoginInput" tabindex="2">
                <input id="guestPIN" type="hidden" placeholder="PIN" tabindex="3">
                <button class="btn btn-primary" id="guestLoginButton" tabindex="4">Join room</button>
            </form>
            <div id="guestLoginProgressBarContainer" class="progress progress-info progress-striped active hide">
                <div id="guestLoginProgressBar" class="bar" style="width: 0%;"></div>
            </div>
            <p>
                <a href="#userLoginPopup" class="btn btn-primary" role="button" data-toggle="modal">
                  Login as <i>Registered</i> User
                </a>
                <a href="#guestLoginPopup" class="btn btn-primary" role="button" data-toggle="modal">
                  Join room as a <i>Guest</i>
                </a>
            </p>*@

            <div id="guestLoginPopup" class="clearfix" tabindex="-1" role="dialog" aria-labelledby="guestLoginLabel" aria-hidden="true">
                @*<div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">x</button>
                    <h3 id="guestLoginLabel">Credentials</h3>
                </div>*@
                <div class="login-left"><img src="/images/logo-vertical.png" alt="right.now. Logo" /></div>

                <div class="login-right">
                    <p><i>right.now.</i> video coaching sessions are conducted in an online virtual meeting room. To join the meeting room please click the button below.</p>

                    <div class="">
                        <div id="guestLoginErrorWrapper" class="alert alert-error hide">
                            <p id="guestLoginError"></p>
                        </div>
                        <form class="form-inline">
                            <fieldset class="hide">
                                <em>
                                    <div class="clearfix">
                                        <label>Guest link</label>

                                        <div class="input-xxlarge">
                                            <input value="@guestRoomUrl" class="input-xxlarge guestLoginInput" id="guestURL" type="url" placeholder="http://PORTAL_ADDRESS/flex.html?roomdirect.html&amp;key=U2AnrCjEaMBx" tabindex="1">
                                        </div>
                                    </div>
                                    <div class="clearfix">
                                        <label>Your name</label>

                                        <div class="input-medium">
                                            <input id="guestName" type="text" value="@currentUser.FirstName @currentUser.LastName" class="guestLoginInput" tabindex="2">
                                        </div>
                                    </div>
                                    <div class="clearfix">
                                        <label>PIN code if provided</label>
                                        <div class="input-medium">
                                            <input id="guestPIN" type="password" placeholder="PIN" tabindex="3">
                                        </div>
                                    </div>
                                </em>
                            </fieldset>
                        </form>
                        <div id="guestLoginProgressBarContainer" class="progress progress-info progress-striped active hide">
                            <div id="guestLoginProgressBar" class="bar" style="width: 80%;"></div>
                        </div>
                    </div>
                    <div class="hide-btn-on-disabled">
                        <button class="btn btnMaterial btn-blue" id="guestLoginButton" tabindex="4">Join room</button>
                    </div>

                </div>
            </div>
        </div>
        <!-- End Main Menu -->

        <!-- Join as user modal window -->
        <div id="preCallJoinAsUserPopup" class="modal hide fade" tabindex="-1" role="dialog">
            <div class="modal-header">
                <h3>Joining to conference...</h3>
            </div>
            <div class="modal-body">
                <div id="preCallJoinProgressBarContainer" class="progress progress-info progress-striped active">
                    <div id="preCallJoinProgressBar" class="bar" style="width: 0%;"></div>
                </div>
            </div>
        </div>
        <div id="preCallIntitePopup" class="modal hide fade" tabindex="-1" data-controls-modal="preCallIntitePopup" data-backdrop="static" data-keyboard="false">
            <div class="modal-header" id="preCallIntitePopupInvitee">
                <!-- Incoming call dialog template placeholder -->
            </div>
            <div class="modal-body">
                <button class="btn btn-primary" id="preCallIntitePopupButtonAccept">Accept</button>
                <button class="btn btn-warning" id="preCallIntitePopupButtonReject">Reject</button>
            </div>
        </div>
        <!-- End join as user modal window -->
        <!-- Login as user modal window -->
        <div id="userLoginPopup" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="userLoginLabel" aria-hidden="true">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">x</button>
                <h3 id="userLoginLabel">Login info</h3>
            </div>
            <div class="modal-body">
                <div id="userLoginErrorWrapper" class="alert alert-error hide">
                    <p id="userLoginError"></p>
                </div>

                <form class="form-inline">
                    <fieldset>
                        <label>Portal</label>

                        <div class="input-medium">
                            <input id="userLoginPortal" type="url" placeholder="http://portalAddress" class="userLoginInput">
                        </div>
                        <label>Username</label>

                        <div class="input-medium">
                            <input id="userLoginUsername" type="text" placeholder="username" class="userLoginInput">
                        </div>
                        <label>Password</label>
                        <div class="input-medium">
                            <input id="userLoginPassword" type="password" placeholder="password" class="userLoginInput">
                        </div>
                    </fieldset>
                </form>
                <div id="userLoginProgressBarContainer" class="progress progress-info progress-striped active hide">
                    <div id="userLoginProgressBar" class="bar" style="width: 0%;"></div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-primary" id="userLoginButton">Login</button>
            </div>
        </div>
        <!-- End Login as user modal window -->

        <!-- Join enter PIN dialog -->
        <div id="preCallJoinConferencePinDialog" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="preCallJoinConferencePinDialogLabel" aria-hidden="true">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">x</button>
                <h3 id="preCallJoinConferencePinDialogLabel">This room is PIN protected</h3>
            </div>
            <div class="modal-body">
                <div id="preCallJoinConferencePinDialogErrorWrapper" class="alert alert-error hide">
                    <p id="preCallJoinConferencePinDialogError"></p>
                </div>
                <form class="form-inline" onsubmit="return false;">
                    <fieldset>
                        <div class="clearfix">
                            <label>PIN code</label>
                            <div class="input-medium">
                                <input id="preCallJoinConferencePinDialogPIN" type="password" tabindex="1">
                            </div>
                        </div>
                    </fieldset>
                </form>
            </div>
            <div class="modal-footer">
                <a class="btn btn-primary" id="preCallJoinConferencePinDialogButton" tabindex="2">Join with PIN</a>
            </div>
        </div>
        <!-- Join enter PIN dialog end -->
        <!-- Login as guest modal window -->
        
        <!-- End Login as guest modal window -->
        <!-- Pre-call container -->
        <div id="preCallContainer" class="container well well-large hide">
            <h5 id="preCallUserInfo" class="muted"><span id="preCallUserDisplayName" class="text-info"></span>, you are @@ <span id="preCallPortalName" class="text-info"></span></h5>
            <div class="navbar">
                <div class="navbar-inner">
                    <!-- <form class="navbar-search pull-left"> -->
                    <input type="text" class="navbar-search pull-left input input-large search-query" placeholder="Search" id="preCallSearchField">
                    <!-- </form> -->
                    <button class="btn btn-primary pull-left" id="preCallJoinMyRoomButton" title="In my room"><i class="icon-home"></i>  Go to my room</button>
                    <button class="btn btn-danger pull-right" id="preCallLogoutButton" title="Logout"><i class="icon-off"></i>  Logout</button>
                </div>
            </div>
            <ul class="nav nav-tabs nav-stacked" id="preCallSearchNavigationList">
            </ul>
            <hr>
        </div>
        <!-- End Pre-call container -->
        <!-- Central in call container -->
        <div id="inCallContainer" class="container hide">

            <!-- Participants/search panel -->
            <aside id="inCallParticipantsPanel" class="hide well">
                <div id="inCallParticipantsListView">
                    <ul id="inCallParticipantsList" class="nav nav-list">
                        <!-- Look at the participantsTemplate in main.config.js  -->
                    </ul>
                </div>
            </aside>
            <!-- End Participants/seach panel -->

            <!-- Plugin and controls panel -->
            <div id="inCallPluginAndControlsWrap">
                <!-- Control buttons -->
                <div class="hide pull-left" id="inCallButtonPanel">
                    <div class="btn-toolbar btn-vertical btn-block">
                        <a class="btn btn-inverse btn-block" href="#" title="Toggle Participant List" id="inCallButtonParticipants"><i class="icon-list"></i><span class="badge badge-important superscript overlap-to-left" id="inCallButtonParticipantsBadge"></span></a>
                    </div>
                    <div class="btn-group btn-group-vertical btn-vertical btn-block">
                        <a class="btn btn-success" href="#" title="Toggle Mute Video" id="inCallButtonMuteVideo"><i class="icon-facetime-video" ></i></a>
                        <a class="btn btn-success" href="#" title="Toggle Mute Speaker" id="inCallButtonMuteSpeaker"><i class="icon-speaker" ></i></a>
                        <a class="btn btn-success" href="#" title="Toggle Mute Microphone" id="inCallButtonMuteMicrophone"><i class="icon-mic"></i></a>
                    </div>
                    <div class="btn-group btn-group-vertical btn-vertical btn-block">
                        <div class="dropdown">
                            <a class="btn btn-inverse btn-no-bottom-radius" role="button" data-toggle="dropdown" href="#" id="inCallButtonLocalShare" title="Share"><i class="icon-share"></i>&nbsp;<b class="caret"></b></a>
                            <ul class="dropdown-menu pull-right" role="menu" id="inCallLocalShareList" aria-labelledby="inCallButtonLocalShare">
                                <!-- Look at the inCallLocalSharesTemplate in main.config.js  -->
                            </ul>
                        </div>
                        <div class="dropdown">
                            <a class="btn btn-inverse disabled btn-no-top-radius" role="button" data-toggle="dropdown" href="#" id="inCallButtonShare" title="Remote Shares"><i class="icon-screen"></i><span class="badge badge-important hide superscript overlap-to-left" id="inCallButtonShareBadge">1</span>&nbsp;<b class="caret"></b></a>
                            <ul class="dropdown-menu pull-right" role="menu" id="inCallShareList" aria-labelledby="inCallButtonShare">
                                <!-- Look at the inCallSharesTemplate in main.config.js  -->
                            </ul>
                        </div>
                    </div>
                    <div class="btn-toolbar btn-vertical btn-block">
                        <a class="btn btn-inverse btn-block" href="#" title="Toggle Full Screen" id="inCallButtonFullscreen"><i class="icon-fullscreen"></i></a>
                    </div>
<!--                     <div class="btn-toolbar btn-vertical btn-block">
                        <a class="btn btn-inverse btn-block" href="#" title="Configuration"><i class="icon-cogs" id="inCallButtonToggleConfig"></i></a>
                    </div> -->
                    <div class="btn-toolbar btn-group btn-vertical btn-block btn-group-single-button">
                        <a class="btn btn-inverse btn-block" href="#" data-toggle="dropdown" title="Change Preview"><i class="icon-user"></i>&nbsp;<b class="caret"></b></a>
                        <ul class="dropdown-menu pull-right" role="menu" id="inCallButtonTogglePreview">
                            <li><a href="#" data-mode="None">None</a></li>
                            <li><a href="#" data-mode="PIP">Picture-In-Picture</a></li>
                            <li><a href="#" data-mode="Dock">Dock</a></li>
                        </ul>
                    </div>
                    <div class="btn-toolbar btn-vertical btn-block">
                        <a class="btn btn-danger btn-block" href="#" title="Disconnect" id="inCallButtonDisconnect"><i class="icon-remove-circle"></i></a>
                    </div>
                </div>
                <!-- End Control buttons -->
                <!-- Plugin wrapper -->
                <div id="pluginAndChatContainer" class="pull-right">
                    <div id="pluginContainer" class="off">
                        <!-- Will autogenerate plugin tag -->
                        <br/>
                    </div>
                    <!-- End Plugin wrapper  -->
                    <!-- Chat container -->
                    <div id="inCallChatContainer" class="well well-small hide">
                        <ul class="nav nav-tabs" id="inCallChatTabs">
                          <li data-uri="group"><a href="#" id="inCallChatMinimizeLink" data-uri="group"><i class="icon-chevron-down"></i></a></li>
                          <li class="active" data-uri="group" id="inCallChatGroupTab"><a href="#inCallChatGroupPane" id="inCallChatGroupTabLink" data-missed="0">Everyone&nbsp;<span class="badge badge-info hide">0</span></a></li>
                        </ul>
                        <div id="inCallChatPanes" class="tab-content">
                          <div class="tab-pane active" id="inCallChatGroupPane">
                            <ul>
                                <!-- Will have chat panes -->
                            </ul>
                          </div>
                        </div>
                        <div>
                            <form class="form-inline" id="inCallChatForm" autocomplete="off">
                              <input type="text" class="input-xxlarge" placeholder="Type a message" id="inCallChatTextField" autocomplete="off">
                              <button type="submit" class="btn btn-grey" id="inCallChatTextSend">Send</button>
                            </form>
                        </div>
                    </div>
                    <!-- End chat container -->
                </div>
            </div>
            <!-- End Plugin and controls panel -->
        </div>
        <!-- End Central container -->


        <!-- Configuration panel -->
        <div class="well configurationContainer hide" id="configurationWrap">
            <!-- See configurationTemplate in main.config.js-->
        </div>
         <!-- End of Configuration panel -->
    </div>
    <!-- End of withjs div -->

    <!-- Will stay if JavaScript is not enabled -->
    <div id="withoutjs" class="hero-unit ">
        <h1>JavaScript is not enabled!</h1>
        <p>JavaScript is not enabled in your browser. To participate in video coaching sessions your browser should have JavaScript enabled.</p>
    </div>
    <div id="notificationContainer" class='notifications top-left'></div>
    <!-- Quickly check for JavaScript -->
    <script type="text/javascript">
    (function () {
        /* jQuery is not available yet so use native JavaScript */
        document.getElementById("withjs").className ="";
        document.getElementById("withoutjs").className += "hide";
    })();
    // IE sometimes does not have console defined. Define it for in this case.
    if (typeof console === 'undefined') {
        console = {
            log: function() {},
            error: function() {},
            debug: function() {},
            warn: function() {}
        }
    }
    // IE8 does not support indexOf, add it
    if (!Array.prototype.indexOf)
    {
      Array.prototype.indexOf = function(elt)
      {
        var len = this.length >>> 0;

        var from = Number(arguments[1]) || 0;
        from = (from < 0)
             ? Math.ceil(from)
             : Math.floor(from);
        if (from < 0)
          from += len;

        for (; from < len; from++)
        {
          if (from in this &&
              this[from] === elt)
            return from;
        }
        return -1;
      };
    }
    </script>
    <!-- Main application script -->
    <script data-main="scripts/main" src="scripts/libs/require.min.2.1.10.js"></script>
</body>
</html>
